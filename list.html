<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>íŒŒì¼ ëª©ë¡</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, sans-serif;
      background: #f5f5f5;
      padding: 40px 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }
    .link {
      display: block;
      text-align: center;
      margin-bottom: 30px;
      color: #007bff;
      text-decoration: none;
      font-weight: 500;
    }
    .link:hover {
      text-decoration: underline;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }
    .item {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .item:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    .thumb {
      width: 100%;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8f8f8;
    }
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .icon {
      font-size: 60px;
    }
    .info {
      padding: 15px;
    }
    .name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 8px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .meta {
      font-size: 12px;
      color: #999;
      margin-bottom: 12px;
    }
    .dl {
      display: inline-block;
      background: #007bff;
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
    }
    .dl:hover {
      background: #0056b3;
    }
    .empty {
      text-align: center;
      padding: 80px 20px;
      color: #999;
    }
    .empty-icon {
      font-size: 72px;
      margin-bottom: 16px;
      opacity: 0.3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ ì—…ë¡œë“œëœ íŒŒì¼</h1>
    <a href="/" class="link">â¬†ï¸ íŒŒì¼ ì—…ë¡œë“œí•˜ê¸°</a>
    <div id="content">
      <div class="empty">
        <div class="empty-icon">â³</div>
        <p>ë¡œë”© ì¤‘...</p>
      </div>
    </div>
  </div>

  <script>
    const icons = {
      pdf: 'ğŸ“„', txt: 'ğŸ“', zip: 'ğŸ“¦',
      png: 'ğŸ–¼ï¸', jpg: 'ğŸ–¼ï¸', jpeg: 'ğŸ–¼ï¸'
    };

    const formatSize = bytes => {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    };

    const formatDate = str => {
      const d = new Date(str);
      return d.toLocaleDateString('ko-KR', {
        year: 'numeric', month: 'short', day: 'numeric',
        hour: '2-digit', minute: '2-digit'
      });
    };

    async function load() {
      try {
        const res = await fetch('/api/files');
        if (!res.ok) throw new Error();
        
        const files = await res.json();
        console.log('ë°›ì€ íŒŒì¼ ë°ì´í„°:', files);
        const content = document.getElementById('content');
        
        if (!files?.length) {
          content.innerHTML = `
            <div class="empty">
              <div class="empty-icon">ğŸ“­</div>
              <p>ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
            </div>
          `;
          return;
        }

        files.sort((a, b) => new Date(b.uploaded_at) - new Date(a.uploaded_at));

        const grid = document.createElement('div');
        grid.className = 'grid';

        files.forEach(f => {
          const ext = f.name.toLowerCase().split('.').pop();
          const thumb = f.is_image
            ? `<img src="${f.url}" alt="${f.name}" loading="lazy">`
            : `<div class="icon">${icons[ext] || 'ğŸ“„'}</div>`;

          const item = document.createElement('div');
          item.className = 'item';
          item.innerHTML = `
            <div class="thumb">${thumb}</div>
            <div class="info">
              <div class="name" title="${f.name}">${f.name}</div>
              <div class="meta">${formatSize(f.size)} Â· ${formatDate(f.uploaded_at)}</div>
              <a href="${f.url}" class="dl" download>ë‹¤ìš´ë¡œë“œ</a>
            </div>
          `;
          grid.appendChild(item);
        });

        content.innerHTML = '';
        content.appendChild(grid);
      } catch (err) {
        console.error('ì—ëŸ¬ ë°œìƒ:', err);
        document.getElementById('content').innerHTML = `
          <div class="empty">
            <div class="empty-icon">âŒ</div>
            <p>íŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
          </div>
        `;
      }
    }

    load();
  </script>
</body>
</html>

